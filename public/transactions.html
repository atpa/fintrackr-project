<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>FinTrackr – Операции</title>
    <link rel="stylesheet" href="css/tokens.css" />
    <link rel="stylesheet" href="css/style.css" />
    <link rel="stylesheet" href="css/design-system.css" />
    <link rel="stylesheet" href="css/sidebar-footer.css" />
    <link rel="stylesheet" href="css/icons.css" />
    <link rel="stylesheet" href="css/transitions.css" />
    <script defer src="js/utils/auth.js"></script>
    <script defer src="js/utils/validation.js"></script>
    <script defer src="js/utils/pagination.js"></script>
    <script defer src="js/app.js"></script>
    <script defer src="js/utils/ui.js"></script>
    <script defer src="js/transactions.js"></script>
    
    <script type="module">
      import { mountSidebar } from '/js/components/Sidebar.js';
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', () => mountSidebar('sidebar-mount'));
      } else {
        mountSidebar('sidebar-mount');
      }
    </script>
  </head>
  <body class="workspace-page" data-page-title="Операции" data-page-subtitle="Все доходы и расходы в одном месте">
    <header role="banner">
      <div class="header-inner">
        <div class="header-left">
          <button class="burger" aria-label="Открыть меню навигации" aria-expanded="false" aria-controls="sidebar">
            <span></span><span></span><span></span>
          </button>
          <div class="logo-text">FinTrackr</div>
        </div>

        <div class="header-center">
          <div class="header-search">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M9 17A8 8 0 1 0 9 1a8 8 0 0 0 0 16zM18 18l-4-4" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            <input type="search" placeholder="Поиск операций, счетов..." aria-label="Поиск" />
          </div>
          
          <select class="currency-selector" aria-label="Выбор валюты">
            <option value="USD">USD</option>
            <option value="EUR">EUR</option>
            <option value="RUB">RUB</option>
            <option value="PLN">PLN</option>
          </select>
        </div>

        <div class="header-right">
          <button class="btn-primary" onclick="location.href='transactions.html'">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <path d="M10 5v10M5 10h10" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
            Операция
          </button>
          
          <div class="header-quick">
            <button class="icon-btn" aria-label="Уведомления">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/>
              </svg>
            </button>
            
            <button class="icon-btn" aria-label="Профиль" onclick="location.href='settings.html'">
              <svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor">
                <path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/>
              </svg>
            </button>
          </div>
        </div>
      </div>
    </header>

    <div id="sidebar-mount"></div>

    <main>
      <!-- Форма для добавления новой операции -->
      <section class="card">
        <h2>Добавить операцию</h2>
        <form id="addTransactionForm">
          <div class="form-grid">
            <div class="form-field">
              <label for="txDate">Дата</label>
              <input type="date" id="txDate" required />
              <span class="form-error" data-error-for="txDate"></span>
            </div>
            <div class="form-field">
              <label for="txAccount">Счёт</label>
              <select id="txAccount" required></select>
              <span class="form-error" data-error-for="txAccount"></span>
            </div>
            <div class="form-field">
              <label for="txCategory">Категория</label>
              <select id="txCategory" required></select>
              <span class="form-error" data-error-for="txCategory"></span>
            </div>
            <div class="form-field">
              <label for="txType">Тип</label>
              <select id="txType" required>
                <option value="income">Доход</option>
                <option value="expense">Расход</option>
              </select>
              <span class="form-error" data-error-for="txType"></span>
            </div>
            <div class="form-field">
              <label for="txAmount">Сумма</label>
              <input type="number" id="txAmount" step="0.01" min="0" required />
              <span class="form-error" data-error-for="txAmount"></span>
            </div>
            <div class="form-field">
              <label for="txCurrency">Валюта</label>
              <select id="txCurrency" required>
                <option value="USD">USD</option>
                <option value="EUR">EUR</option>
                <option value="PLN">PLN</option>
                <option value="RUB">RUB</option>
              </select>
              <span class="form-error" data-error-for="txCurrency"></span>
            </div>
            <div class="form-field" style="flex: 1 1 240px">
              <label for="txNote">Примечание</label>
              <input type="text" id="txNote" placeholder="Например, обед или бонус" />
            </div>
          </div>
          <button type="submit" class="btn-primary" style="margin-top: 1rem">
            Добавить
          </button>
        </form>
      </section>

      <!-- Фильтр операций -->
      <section class="card">
        <h2>Фильтр операций</h2>
        <form id="filterTxForm">
          <div class="filter-grid">
            <div class="form-field">
              <label for="filterStart">От</label>
              <input type="date" id="filterStart" />
            </div>
            <div class="form-field">
              <label for="filterEnd">До</label>
              <input type="date" id="filterEnd" />
            </div>
            <div class="form-field">
              <label for="filterCategory">Категория</label>
              <select id="filterCategory">
                <option value="">Все</option>
              </select>
            </div>
            <div class="form-field">
              <label for="filterType">Тип</label>
              <select id="filterType">
                <option value="">Все</option>
                <option value="income">Доход</option>
                <option value="expense">Расход</option>
              </select>
            </div>
            <div class="form-field">
              <label for="filterSearch">Поиск</label>
              <input
                type="text"
                id="filterSearch"
                placeholder="Название, примечание или сумма"
              />
            </div>
            <div class="form-field" style="align-self: end; flex: 0 0 auto">
              <button type="submit" class="btn-primary">Применить</button>
            </div>
          </div>
        </form>
      </section>
      <!-- Список операций (карточки) -->
      <section class="card">
        <h2>Список операций</h2>
        <div class="filter-grid" style="margin-bottom: 1rem">
          <div class="form-field" style="flex:0 0 200px">
            <label>Быстрый период</label>
            <div style="display:flex; gap:8px; flex-wrap:wrap">
              <button type="button" class="btn-secondary" data-quick-period="today">Today</button>
              <button type="button" class="btn-secondary" data-quick-period="week">Week</button>
              <button type="button" class="btn-secondary" data-quick-period="month">Month</button>
            </div>
          </div>
        </div>
        <div id="transactionsList" class="tx-list" aria-live="polite">
          <div class="tx-item" role="status">
            <div class="tx-main">
              <span class="tx-title">Загрузка...</span>
              <span class="tx-meta">Пожалуйста, подождите</span>
            </div>
          </div>
        </div>
        <div class="table-controls" style="margin-top: 12px; display:flex; justify-content: space-between; align-items:center; gap: 12px;">
          <div>
            <label style="display: flex; align-items: center; gap: 0.5rem">
              <span>На странице:</span>
              <select id="transactionsPageSize">
                <option value="5">5</option>
                <option value="10" selected>10</option>
                <option value="20">20</option>
              </select>
            </label>
          </div>
          <div class="table-pagination" id="transactionsPagination"></div>
        </div>
      </section>
    </main>
    <footer>
      <p>&copy; 2025 FinTrackr. Все права защищены.</p>
    </footer>
  </body>
</html>
