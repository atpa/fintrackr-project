import{i as y}from"./navigation-BDLIzq93.js";import{i as h}from"./profile-DStBtrFs.js";y();h();document.addEventListener("DOMContentLoaded",f);function f(){C().then(()=>{i()});const o=document.getElementById("addRuleForm");o&&o.addEventListener("submit",async r=>{r.preventDefault();const n=document.getElementById("ruleKeyword"),a=document.getElementById("ruleCategorySelect"),e=n.value.trim(),t=Number(a.value);if(!(!e||!t))try{(await fetch("/api/rules",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({keyword:e,category_id:t})})).ok?(n.value="",await i()):alert("Ошибка при добавлении правила")}catch(c){console.error(c),alert("Ошибка сети")}})}async function C(){try{const r=await(await fetch("/api/categories")).json(),n=document.getElementById("ruleCategorySelect");n.innerHTML="",r.forEach(a=>{const e=document.createElement("option");e.value=a.id,e.textContent=a.name,n.appendChild(e)})}catch(o){console.error(o)}}async function i(){try{const r=await(await fetch("/api/rules")).json(),n=document.querySelector("#rulesTable tbody");if(n.innerHTML="",!r||r.length===0){const e=document.createElement("tr"),t=document.createElement("td");t.colSpan=3,t.textContent="Нет правил",e.appendChild(t),n.appendChild(e);return}let a=[];try{a=await(await fetch("/api/categories")).json()}catch{}r.forEach(e=>{var p;const t=document.createElement("tr"),c=document.createElement("td");c.textContent=e.keyword,t.appendChild(c);const l=document.createElement("td"),u=((p=a.find(s=>s.id===e.category_id))==null?void 0:p.name)||e.category_id;l.textContent=u,t.appendChild(l);const m=document.createElement("td"),d=document.createElement("button");d.textContent="Удалить",d.className="btn-danger",d.addEventListener("click",async()=>{if(confirm("Удалить правило?"))try{(await fetch(`/api/rules/${e.id}`,{method:"DELETE"})).ok?await i():alert("Ошибка удаления")}catch(s){console.error(s)}}),m.appendChild(d),t.appendChild(m),n.appendChild(t)})}catch(o){console.error(o)}}
