import{i as e}from"./chunks/navigation-BNxy9xC7.js";import{i as t}from"./chunks/profile-BfLkpaKJ.js";import{A as n}from"./chunks/api-BDCGX8nm.js";import{a,t as c}from"./chunks/Toast-Cw3r9-oW.js";import{c as o}from"./chunks/ModalBase-nBdty8ot.js";async function d(){try{const e=await n.rules.getAll(),t=document.querySelector("#rulesTable tbody");if(t.innerHTML="",!e||0===e.length){const e=document.createElement("tr"),n=document.createElement("td");return n.colSpan=3,n.textContent="Нет правил",e.appendChild(n),void t.appendChild(e)}let r=[];try{r=await n.categories.getAll()}catch{}e.forEach(e=>{var l;const i=document.createElement("tr"),s=document.createElement("td");s.textContent=e.keyword,i.appendChild(s);const m=document.createElement("td"),u=(null==(l=r.find(t=>t.id===e.category_id))?void 0:l.name)||e.category_id;m.textContent=u,i.appendChild(m);const p=document.createElement("td"),g=document.createElement("button");g.textContent="Удалить",g.className="btn-danger",g.addEventListener("click",async()=>{if(await o({title:"Удалить правило?",message:"Это действие нельзя отменить",danger:!0}))try{await n.rules.delete(e.id),c("Правило удалено"),await d()}catch(t){a(`Не удалось удалить: ${t.message}`)}}),p.appendChild(g),i.appendChild(p),t.appendChild(i)})}catch(e){a(`Не удалось загрузить правила: ${e.message}`)}}e(),t(),document.addEventListener("DOMContentLoaded",function(){(async function(){try{const e=await n.categories.getAll(),t=document.getElementById("ruleCategorySelect");t.innerHTML="",e.forEach(e=>{const n=document.createElement("option");n.value=e.id,n.textContent=e.name,t.appendChild(n)})}catch(e){a(`Не удалось загрузить категории: ${e.message}`)}})().then(()=>{d()});const e=document.getElementById("addRuleForm");e&&e.addEventListener("submit",async e=>{e.preventDefault();const t=document.getElementById("ruleKeyword"),o=document.getElementById("ruleCategorySelect"),r=t.value.trim(),l=Number(o.value);if(r&&l)try{await n.rules.create({keyword:r,category_id:l}),t.value="",c("Правило добавлено"),await d()}catch(i){a(`Не удалось добавить правило: ${i.message}`)}else a("Заполните все поля")})});
