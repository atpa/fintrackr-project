import{i as e}from"./chunks/navigation-BNxy9xC7.js";import{i as t}from"./chunks/profile-BfLkpaKJ.js";import{A as n}from"./chunks/api-BDCGX8nm.js";import{t as a,a as o}from"./chunks/Toast-Cw3r9-oW.js";function c(e,t,n,a){if(a.innerHTML="",!e.length){const e=document.createElement("tr"),t=document.createElement("td");return t.colSpan=7,t.textContent="Нет запланированных операций",e.appendChild(t),void a.appendChild(e)}e.forEach(e=>{const o=document.createElement("tr"),c=document.createElement("td");c.textContent=e.start_date;const d=document.createElement("td");d.textContent={daily:"Ежедневно",weekly:"Еженедельно",monthly:"Ежемесячно",yearly:"Ежегодно"}[e.frequency]||e.frequency;const m=document.createElement("td"),l=t.find(t=>t.id===e.account_id);m.textContent=l?l.name:"—";const u=document.createElement("td"),r=n.find(t=>t.id===e.category_id);u.textContent=r?r.name:"—";const s=document.createElement("td");s.textContent="income"===e.type?"Доход":"Расход",s.className="income"===e.type?"status-income":"status-expense";const i=document.createElement("td");i.textContent=Number(e.amount).toFixed(2)+" "+e.currency,i.className="income"===e.type?"status-income":"status-expense";const p=document.createElement("td");p.textContent=e.note||"",o.append(c,d,m,u,s,i,p),a.appendChild(o)})}async function d(){const e=document.querySelector("#plannedTable tbody");if(e)try{let[t,d,m]=await Promise.all([n.planned.getAll(),n.accounts.getAll(),n.categories.getAll()]);c(t,d,m,e);const l=document.getElementById("plannedAccount"),u=document.getElementById("plannedCategory");l&&(l.innerHTML="",d.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,l.appendChild(t)})),u&&(u.innerHTML="",m.forEach(e=>{const t=document.createElement("option");t.value=e.id,t.textContent=e.name,u.appendChild(t)}));const r=document.getElementById("plannedStart");if(r){const e=(new Date).toISOString().slice(0,10);r.value=e}const s=document.getElementById("addPlannedForm");s&&s.addEventListener("submit",async i=>{i.preventDefault();const p={account_id:Number(l.value),category_id:Number(u.value),type:document.getElementById("plannedType").value,amount:parseFloat(document.getElementById("plannedAmount").value),currency:document.getElementById("plannedCurrency").value,start_date:document.getElementById("plannedStart").value,frequency:document.getElementById("plannedFrequency").value,note:document.getElementById("plannedNote").value};try{const o=await n.planned.create(p);t.push(o),a("Плановая операция добавлена!"),c(t,d,m,e),s.reset(),r&&(r.value=(new Date).toISOString().slice(0,10))}catch(y){o(`Не удалось добавить плановую операцию: ${y.message}`)}})}catch(t){o(`Не удалось загрузить данные: ${t.message}`)}}e(),t(),"loading"!==document.readyState?d():document.addEventListener("DOMContentLoaded",d);
