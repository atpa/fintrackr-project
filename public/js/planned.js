import{i as v,f as E}from"./profile-DStBtrFs.js";import{i as T}from"./navigation-BDLIzq93.js";T();v();function C(r,i,l,c){if(c.innerHTML="",!r.length){const e=document.createElement("tr"),n=document.createElement("td");n.colSpan=7,n.textContent="Нет запланированных операций",e.appendChild(n),c.appendChild(e);return}r.forEach(e=>{const n=document.createElement("tr"),d=document.createElement("td");d.textContent=e.start_date;const m=document.createElement("td"),a={daily:"Ежедневно",weekly:"Еженедельно",monthly:"Ежемесячно",yearly:"Ежегодно"};m.textContent=a[e.frequency]||e.frequency;const t=document.createElement("td"),o=i.find(f=>f.id===e.account_id);t.textContent=o?o.name:"—";const s=document.createElement("td"),u=l.find(f=>f.id===e.category_id);s.textContent=u?u.name:"—";const p=document.createElement("td");p.textContent=e.type==="income"?"Доход":"Расход",p.className=e.type==="income"?"status-income":"status-expense";const y=document.createElement("td");y.textContent=Number(e.amount).toFixed(2)+" "+e.currency,y.className=e.type==="income"?"status-income":"status-expense";const g=document.createElement("td");g.textContent=e.note||"",n.append(d,m,t,s,p,y,g),c.appendChild(n)})}async function h(){const r=document.querySelector("#plannedTable tbody");if(!r)return;let[i,l,c]=await Promise.all([E("/api/planned"),E("/api/accounts"),E("/api/categories")]);C(i,l,c,r);const e=document.getElementById("plannedAccount"),n=document.getElementById("plannedCategory");e&&(e.innerHTML="",l.forEach(a=>{const t=document.createElement("option");t.value=a.id,t.textContent=a.name,e.appendChild(t)})),n&&(n.innerHTML="",c.forEach(a=>{const t=document.createElement("option");t.value=a.id,t.textContent=a.name,n.appendChild(t)}));const d=document.getElementById("plannedStart");if(d){const a=new Date().toISOString().slice(0,10);d.value=a}const m=document.getElementById("addPlannedForm");m&&m.addEventListener("submit",async a=>{a.preventDefault();const t={account_id:Number(e.value),category_id:Number(n.value),type:document.getElementById("plannedType").value,amount:parseFloat(document.getElementById("plannedAmount").value),currency:document.getElementById("plannedCurrency").value,start_date:document.getElementById("plannedStart").value,frequency:document.getElementById("plannedFrequency").value,note:document.getElementById("plannedNote").value};try{const o=await fetch("/api/planned",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!o.ok){const u=await o.json();alert("Ошибка: "+(u.error||"не удалось добавить плановую операцию"));return}const s=await o.json();i.push(s),C(i,l,c,r),m.reset(),d&&(d.value=new Date().toISOString().slice(0,10))}catch(o){console.error(o),alert("Ошибка сети")}})}document.readyState!=="loading"?h():document.addEventListener("DOMContentLoaded",h);
