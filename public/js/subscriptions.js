import{i as v,p as x,d as E,f as L}from"./profile-DStBtrFs.js";import{i as w}from"./navigation-BDLIzq93.js";w();v();(function(){const r=document.getElementById("subscriptionsList"),i=document.getElementById("subForm"),u=document.getElementById("subTitle"),l=document.getElementById("subAmount"),d=document.getElementById("subCurrency"),m=document.getElementById("subFrequency"),f=document.getElementById("subDate");function p(t,n){return typeof window.formatCurrency=="function"?window.formatCurrency(t,n):`${(Number(t)||0).toFixed(2)} ${n||""}`.trim()}async function a(){r&&(r.innerHTML="<p>Loading…</p>");try{const t=await L("/api/subscriptions");y(t)}catch(t){r.innerHTML=`<p class="text-danger">${t.message||"Failed to load subscriptions"}</p>`}}function y(t){if(!r)return;if(!Array.isArray(t)||t.length===0){r.innerHTML="<p>No subscriptions yet.</p>";return}const n=t.map(e=>`
        <div class="row" style="align-items:center; gap:.5rem; padding:.5rem 0; border-bottom:1px solid var(--border)">
          <div style="flex:2 1 220px"><strong>${o(e.title)}</strong></div>
          <div style="flex:1 1 140px">${p(e.amount,e.currency)}</div>
          <div style="flex:1 1 140px">${o(e.frequency||"")}</div>
          <div style="flex:1 1 160px">${e.nextDate?o(e.nextDate):"-"}</div>
          <div style="flex:0 0 auto">
            <button class="btn-secondary" data-del="${e.id}">Удалить</button>
          </div>
        </div>`).join("");r.innerHTML=n}function o(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}i&&i.addEventListener("submit",async t=>{t.preventDefault();const n=u.value.trim(),e=Number(l.value),s=d.value,g=m.value,c=f.value||null;if(!n)return alert("Введите название подписки");if(!isFinite(e)||e<0)return alert("Введите корректную сумму");if(!c)return alert("Укажите дату следующего списания");try{await x("/api/subscriptions",{title:n,amount:e,currency:s,frequency:g,next_date:c}),i.reset(),await a()}catch(b){alert(b.message||"Не удалось сохранить подписку")}}),r==null||r.addEventListener("click",async t=>{const n=t.target.closest("[data-del]");if(!n)return;const e=n.getAttribute("data-del");if(e&&confirm("Удалить подписку?"))try{await E(`/api/subscriptions/${e}`),await a()}catch(s){alert(s.message||"Не удалось удалить подписку")}}),document.addEventListener("DOMContentLoaded",a)})();
