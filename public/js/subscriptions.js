import{i as E}from"./navigation-BDLIzq93.js";import{i as w}from"./profile-BEROGLl0.js";E();w();(function(){const r=document.getElementById("subscriptionsList"),a=document.getElementById("subForm"),d=document.getElementById("subTitle"),l=document.getElementById("subAmount"),u=document.getElementById("subCurrency"),m=document.getElementById("subFrequency"),f=document.getElementById("subDate");function p(t,n){return typeof window.formatCurrency=="function"?window.formatCurrency(t,n):`${(Number(t)||0).toFixed(2)} ${n||""}`.trim()}async function c(){r.innerHTML="<p>Загрузка…</p>";try{const t=await fetch("/api/subscriptions");if(!t.ok)throw new Error("Failed to load");const n=await t.json();y(n)}catch(t){r.innerHTML=`<p class="text-danger">Ошибка загрузки: ${t.message}</p>`}}function y(t){if(!Array.isArray(t)||t.length===0){r.innerHTML="<p>Подписок пока нет.</p>";return}const n=t.map(e=>`
        <div class="row" style="align-items:center; gap:.5rem; padding:.5rem 0; border-bottom:1px solid var(--border)">
          <div style="flex:2 1 220px"><strong>${s(e.title)}</strong></div>
          <div style="flex:1 1 140px">${p(e.amount,e.currency)}</div>
          <div style="flex:1 1 140px">${s(e.frequency||"")}</div>
          <div style="flex:1 1 160px">${e.nextDate||e.next_date?s(e.nextDate||e.next_date):"—"}</div>
          <div style="flex:0 0 auto">
            <button class="btn-secondary" data-del="${e.id}">Удалить</button>
          </div>
        </div>`).join("");r.innerHTML=n}function s(t){return String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}a&&a.addEventListener("submit",async t=>{t.preventDefault();const n=d.value.trim(),e=Number(l.value),o=u.value,g=m.value,b=f.value||null;if(!n)return alert("Введите название подписки");if(!isFinite(e)||e<0)return alert("Введите корректную сумму");try{const i=await fetch("/api/subscriptions",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:n,amount:e,currency:o,frequency:g,next_date:b})});if(!i.ok){const v=await i.json().catch(()=>({}));throw new Error(v.error||"Не удалось добавить подписку")}a.reset(),await c()}catch(i){alert(i.message)}}),r==null||r.addEventListener("click",async t=>{const n=t.target.closest("[data-del]");if(!n)return;const e=n.getAttribute("data-del");if(e&&confirm("Удалить подписку?"))try{if(!(await fetch(`/api/subscriptions/${e}`,{method:"DELETE"})).ok)throw new Error("Не удалось удалить");await c()}catch(o){alert(o.message)}}),document.addEventListener("DOMContentLoaded",c)})();
