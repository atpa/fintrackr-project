import{i as e}from"./chunks/navigation-BNxy9xC7.js";import{i as t}from"./chunks/profile-BfLkpaKJ.js";import{A as n}from"./chunks/api-BDCGX8nm.js";import{a,t as r}from"./chunks/Toast-Cw3r9-oW.js";import{c as s}from"./chunks/ModalBase-nBdty8ot.js";e(),t(),function(){const e=document.getElementById("subscriptionsList"),t=document.getElementById("subForm"),i=document.getElementById("subTitle"),o=document.getElementById("subAmount"),c=document.getElementById("subCurrency"),u=document.getElementById("subFrequency"),d=document.getElementById("subDate");async function l(){e.innerHTML="<p>Загрузка…</p>";try{!function(t){if(!Array.isArray(t)||0===t.length)return void(e.innerHTML="<p>Подписок пока нет.</p>");const n=t.map(e=>{return`\n        <div class="row" style="align-items:center; gap:.5rem; padding:.5rem 0; border-bottom:1px solid var(--border)">\n          <div style="flex:2 1 220px"><strong>${m(e.title)}</strong></div>\n          <div style="flex:1 1 140px">${t=e.amount,n=e.currency,"function"==typeof window.formatCurrency?window.formatCurrency(t,n):`${(Number(t)||0).toFixed(2)} ${n||""}`.trim()}</div>\n          <div style="flex:1 1 140px">${m(e.frequency||"")}</div>\n          <div style="flex:1 1 160px">${e.nextDate||e.next_date?m(e.nextDate||e.next_date):"—"}</div>\n          <div style="flex:0 0 auto">\n            <button class="btn-secondary" data-del="${e.id}">Удалить</button>\n          </div>\n        </div>`;var t,n}).join("");e.innerHTML=n}(await n.subscriptions.getAll())}catch(t){e.innerHTML=`<p class="text-danger">Ошибка загрузки: ${t.message}</p>`,a(`Не удалось загрузить подписки: ${t.message}`)}}function m(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}t&&t.addEventListener("submit",async e=>{e.preventDefault();const s=i.value.trim(),m=Number(o.value),p=c.value,g=u.value,y=d.value||null;if(s)if(!isFinite(m)||m<0)a("Введите корректную сумму");else try{await n.subscriptions.create({title:s,amount:m,currency:p,frequency:g,next_date:y}),r("Подписка добавлена"),t.reset(),await l()}catch(f){a(`Не удалось добавить подписку: ${f.message}`)}else a("Введите название подписки")}),null==e||e.addEventListener("click",async e=>{const t=e.target.closest("[data-del]");if(!t)return;const i=t.getAttribute("data-del");if(!i)return;if(await s({title:"Удалить подписку?",message:"Это действие нельзя отменить",danger:!0}))try{await n.subscriptions.delete(i),r("Подписка удалена"),await l()}catch(o){a(`Не удалось удалить: ${o.message}`)}}),document.addEventListener("DOMContentLoaded",l)}();
