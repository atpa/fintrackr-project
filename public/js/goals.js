import{f as g}from"./api-D6s1A7e-.js";import{i as f}from"./navigation-BDLIzq93.js";import{i as E}from"./profile-BEROGLl0.js";f();E();function m(a,n){if(n.innerHTML="",!a.length){const e=document.createElement("p");e.textContent="Цели отсутствуют",n.appendChild(e);return}a.forEach(e=>{const o=document.createElement("div");o.className="goal-card";const d=document.createElement("h3");d.textContent=e.title;const t=document.createElement("p"),i=Number(e.current_amount||0),r=Number(e.target_amount);t.innerHTML=`<strong>${i.toFixed(2)}</strong> / ${r.toFixed(2)}`;const l=document.createElement("div");l.className="progress-bar-small";const s=document.createElement("div"),p=r>0?Math.min(i/r*100,100):0;s.style.width=p.toFixed(0)+"%",l.appendChild(s);const c=document.createElement("p");c.className="deadline",c.textContent=e.deadline?`Дедлайн: ${e.deadline}`:"Без дедлайна",o.append(d,t,l,c),n.appendChild(o)})}async function u(){const a=document.getElementById("goalsGrid");if(!a)return;let n=await g("/api/goals");m(n,a);const e=document.getElementById("addGoalForm");e&&e.addEventListener("submit",async o=>{o.preventDefault();const d={title:document.getElementById("goalTitle").value,target_amount:parseFloat(document.getElementById("goalTarget").value),current_amount:parseFloat(document.getElementById("goalCurrent").value)||0,deadline:document.getElementById("goalDeadline").value};try{const t=await fetch("/api/goals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!t.ok){const r=await t.json();alert("Ошибка: "+(r.error||"не удалось добавить цель"));return}const i=await t.json();n.push(i),m(n,a),e.reset()}catch(t){console.error(t),alert("Ошибка сети")}})}document.readyState!=="loading"?u():document.addEventListener("DOMContentLoaded",u);
