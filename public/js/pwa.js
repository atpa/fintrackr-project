let n,t;async function e(){if(!("serviceWorker"in navigator))return null;try{const n=await navigator.serviceWorker.register("/sw.js",{scope:"/"});return n.addEventListener("updatefound",()=>{const t=n.installing;t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&(window.toastInfo?window.toastInfo("Доступно обновление приложения. Обновите страницу.",{duration:1e4,action:{label:"Обновить",onClick:()=>window.location.reload()}}):confirm("Доступно обновление приложения. Обновить сейчас?")&&window.location.reload())})}),t=n,n}catch(n){return null}}async function o(){if(!n)return!1;try{n.prompt();const{outcome:t}=await n.userChoice;return n=null,"accepted"===t}catch(t){return!1}}async function i(){await e(),window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),n=t;const e=document.getElementById("install-button");e&&(e.style.display="block",e.addEventListener("click",o))}),window.addEventListener("appinstalled",()=>{n=null;const t=document.getElementById("install-button");t&&(t.style.display="none"),window.toastSuccess&&window.toastSuccess("Приложение успешно установлено!")}),function(){const n=()=>{const n=navigator.onLine,t=document.getElementById("network-status");t&&(t.className=n?"online":"offline",t.textContent=n?"Online":"Offline"),document.body.classList.toggle("is-offline",!n)};window.addEventListener("online",()=>{n(),window.toastSuccess&&window.toastSuccess("Соединение восстановлено")}),window.addEventListener("offline",()=>{n(),window.toastWarning&&window.toastWarning("Работа в offline режиме")}),n()}();!!window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone,function(){if(!navigator.onLine)return{online:!1,type:"offline"};const n=navigator.connection||navigator.mozConnection||navigator.webkitConnection;n&&(n.effectiveType,n.downlink,n.rtt,n.saveData)}()}"undefined"!=typeof window&&("loading"===document.readyState?document.addEventListener("DOMContentLoaded",i):i());
