import{i as e}from"./chunks/navigation-BNxy9xC7.js";import{A as t}from"./chunks/api-BDCGX8nm.js";import{i as n}from"./chunks/profile-BfLkpaKJ.js";import{c as o,r}from"./chunks/charts-BffCuP_9.js";import{s as u,c as a,h as c}from"./chunks/SkeletonLoader-CzourGF4.js";import"./cardAccount.js";e(),n();let s=null,l=null;async function p(){const e=document.getElementById("reportPeriod").value,n=document.getElementById("reportMonth"),p=document.getElementById("reportYear"),[m,i]=await Promise.all([t.transactions.getAll(),t.categories.getAll()]),d=m.filter(t=>{const o=new Date(t.date);if("month"===e){const e=n.value;if(!e)return!1;const[t,r]=e.split("-").map(Number);return o.getFullYear()===t&&o.getMonth()+1===r}{const e=parseInt(p.value,10);return!!e&&o.getFullYear()===e}}),y=function(e,t){const n=new Map;return e.forEach(e=>{if("expense"===e.type){const o=t.find(t=>t.id===e.category_id),r=o?o.name:"Неизвестно",u=n.get(r)||0,a="function"==typeof getReportCurrency?getReportCurrency():"USD",c="function"==typeof convertAmount?convertAmount(Number(e.amount),e.currency||"USD",a):Number(e.amount);n.set(r,u+c)}}),n}(d,i),g=Array.from(y.keys()),f=Array.from(y.values()),h=[],v=[],E=g.map((e,t)=>({label:e,value:f[t]}));E.sort((e,t)=>t.value-e.value);let I=0;E.forEach((e,t)=>{t<8?(h.push(e.label),v.push(e.value)):I+=e.value}),I>0&&(h.push("Другие"),v.push(I));const A=document.getElementById("reportChart"),B=null==A?void 0:A.parentElement;A&&B&&(s&&s.destroy(),u(B,a("bar")),setTimeout(()=>{c(B,A);const e="function"==typeof getReportCurrency?getReportCurrency():"USD",t=o(d.filter(e=>"expense"===e.type),i,e);s=r(A,t)},300));const C=document.getElementById("reportPie"),S=null==C?void 0:C.parentElement;C&&S&&(l&&l.destroy(),u(S,a("pie")),setTimeout(()=>{c(S,C);const e="function"==typeof getReportCurrency?getReportCurrency():"USD",t=o(d.filter(e=>"expense"===e.type),i,e);l=r(C,t)},300));const D=document.getElementById("reportSummary");if(D){let t=0,n=0;d.forEach(e=>{const o="function"==typeof getReportCurrency?getReportCurrency():"USD",r="function"==typeof convertAmount?convertAmount(Number(e.amount),e.currency||"USD",o):Number(e.amount);"income"===e.type?t+=r:"expense"===e.type&&(n+=r)});let o="";const r="function"==typeof getReportCurrency?getReportCurrency():"USD";if(o+=`<p><strong>Суммарный доход:</strong> ${t.toFixed(2)} ${r}</p>`,o+=`<p><strong>Суммарный расход:</strong> ${n.toFixed(2)} ${r}</p>`,h.length>0){o+=`<p><strong>Наибольшие расходы:</strong> категория "${h[0]}" — ${v[0].toFixed(2)} ${r}</p>`}o+="month"===e?"<p>AI‑отчёт: в этом месяце ваши расходы распределены по категориям, как показано на диаграмме. Обратите внимание на категории с наибольшими тратами.</p>":"<p>AI‑отчёт: в этом году основные траты приходятся на показанные категории. Анализируйте ваши расходы, чтобы лучше планировать бюджет.</p>",D.innerHTML=o}}async function m(){const e=document.getElementById("reportPeriod"),t=document.getElementById("reportMonth"),n=document.getElementById("reportYear"),o=document.getElementById("reportMonthLabel"),r=document.getElementById("reportYearLabel"),u=new Date,a=u.getFullYear(),c=String(u.getMonth()+1).padStart(2,"0");t&&(t.value=`${a}-${c}`),n&&(n.value=`${a}`),e&&e.addEventListener("change",()=>{"month"===e.value?(o&&(o.style.display=""),r&&(r.style.display="none")):(o&&(o.style.display="none"),r&&(r.style.display=""))});const s=document.getElementById("generateReport");s&&s.addEventListener("click",e=>{e.preventDefault(),p()}),p()}"loading"!==document.readyState?m():document.addEventListener("DOMContentLoaded",m);
