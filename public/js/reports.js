import{f as B}from"./api-Cdk2p__r.js";import{i as L}from"./navigation-BDLIzq93.js";import{i as $}from"./profile-BEROGLl0.js";L();$();function M(s,m){const i=new Map;return s.forEach(e=>{if(e.type==="expense"){const a=m.find(r=>r.id===e.category_id),u=a?a.name:"Неизвестно",l=i.get(u)||0,d=typeof getReportCurrency=="function"?getReportCurrency():"USD",p=typeof convertAmount=="function"?convertAmount(Number(e.amount),e.currency||"USD",d):Number(e.amount);i.set(u,l+p)}}),i}async function S(){const s=document.getElementById("reportPeriod").value,m=document.getElementById("reportMonth"),i=document.getElementById("reportYear"),[e,a]=await Promise.all([B("/api/transactions"),B("/api/categories")]),u=e.filter(t=>{const n=new Date(t.date);if(s==="month"){const o=m.value;if(!o)return!1;const[f,c]=o.split("-").map(Number);return n.getFullYear()===f&&n.getMonth()+1===c}else{const o=parseInt(i.value,10);return o?n.getFullYear()===o:!1}}),l=M(u,a),d=Array.from(l.keys()),p=Array.from(l.values()),r=[],y=[],v=d.map((t,n)=>({label:t,value:p[n]}));v.sort((t,n)=>n.value-t.value);let g=0;v.forEach((t,n)=>{n<8?(r.push(t.label),y.push(t.value)):g+=t.value}),g>0&&(r.push("Другие"),y.push(g));const E=document.getElementById("reportChart");E&&drawBarChart(E,r,y);const I=document.getElementById("reportPie");I&&drawPieChart(I,r,y);const C=document.getElementById("reportSummary");if(C){let t=0,n=0;u.forEach(c=>{const h=typeof getReportCurrency=="function"?getReportCurrency():"USD",b=typeof convertAmount=="function"?convertAmount(Number(c.amount),c.currency||"USD",h):Number(c.amount);c.type==="income"?t+=b:c.type==="expense"&&(n+=b)});let o="";const f=typeof getReportCurrency=="function"?getReportCurrency():"USD";if(o+=`<p><strong>Суммарный доход:</strong> ${t.toFixed(2)} ${f}</p>`,o+=`<p><strong>Суммарный расход:</strong> ${n.toFixed(2)} ${f}</p>`,r.length>0){const c=r[0],h=y[0];o+=`<p><strong>Наибольшие расходы:</strong> категория "${c}" — ${h.toFixed(2)} ${f}</p>`}s==="month"?o+="<p>AI‑отчёт: в этом месяце ваши расходы распределены по категориям, как показано на диаграмме. Обратите внимание на категории с наибольшими тратами.</p>":o+="<p>AI‑отчёт: в этом году основные траты приходятся на показанные категории. Анализируйте ваши расходы, чтобы лучше планировать бюджет.</p>",C.innerHTML=o}}async function D(){const s=document.getElementById("reportPeriod"),m=document.getElementById("reportMonth"),i=document.getElementById("reportYear"),e=document.getElementById("reportMonthLabel"),a=document.getElementById("reportYearLabel"),u=new Date,l=u.getFullYear(),d=String(u.getMonth()+1).padStart(2,"0");m&&(m.value=`${l}-${d}`),i&&(i.value=`${l}`),s&&s.addEventListener("change",()=>{s.value==="month"?(e&&(e.style.display=""),a&&(a.style.display="none")):(e&&(e.style.display="none"),a&&(a.style.display=""))});const p=document.getElementById("generateReport");p&&p.addEventListener("click",r=>{r.preventDefault(),S()}),S()}document.readyState!=="loading"?D():document.addEventListener("DOMContentLoaded",D);
