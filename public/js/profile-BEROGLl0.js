const a={USER_KEY:"user",THEME_KEY:"ft_theme",isLoggedIn(){try{return!!localStorage.getItem(this.USER_KEY)}catch(e){return console.error("Auth: localStorage недоступен",e),!1}},getUser(){try{const e=localStorage.getItem(this.USER_KEY);return e?JSON.parse(e):null}catch(e){return console.error("Auth: Ошибка парсинга данных пользователя",e),null}},login(e){try{return!e||!e.email?(console.error("Auth: Некорректные данные пользователя"),!1):(localStorage.setItem(this.USER_KEY,JSON.stringify(e)),!0)}catch(t){return console.error("Auth: Ошибка сохранения пользователя",t),!1}},logout(){try{return localStorage.removeItem(this.USER_KEY),!0}catch(e){return console.error("Auth: Ошибка удаления данных пользователя",e),!1}},requiresAuth(e){return!["landing.html","index.html","login.html","register.html","features.html","benefits.html","about.html"].includes(e.toLowerCase())},redirectIfNotAuthenticated(){const e=window.location.pathname.split("/").pop().toLowerCase()||"index.html";this.requiresAuth(e)&&!this.isLoggedIn()&&(window.location.href="login.html")},getTheme(){try{return localStorage.getItem(this.THEME_KEY)||"light"}catch{return"light"}},setTheme(e){try{localStorage.setItem(this.THEME_KEY,e)}catch(t){console.error("Auth: Ошибка сохранения темы",t)}}},s=new Set(["landing.html","index.html","login.html","register.html","features.html","benefits.html","about.html","premium.html","education.html"]);function u(){return(window.location.pathname.split("/").pop()||""||"index.html").toLowerCase()}function m(e){const t=document.querySelector(".profile-name"),r=document.querySelector(".profile-email");t&&(t.textContent=(e==null?void 0:e.name)||"Пользователь"),r&&(r.textContent=(e==null?void 0:e.email)||"")}function h(e,t){const r=document.querySelector(".login-link"),n=document.querySelector(".register-link"),o=document.querySelector(".logout-link");e?(r&&(r.style.display="none"),n&&(n.style.display="none"),o&&(o.style.display="inline-block",o.addEventListener("click",l=>{l.preventDefault(),a.logout(),window.location.href=t},{once:!0}))):(o&&(o.style.display="none"),r&&(r.style.display="inline-block"),n&&(n.style.display="inline-block"))}function c({requireAuth:e=!0,loginPath:t="login.html",logoutRedirect:r="landing.html",publicPages:n=s}={}){const o=u(),l=n.has(o);if(e&&!l&&!a.isLoggedIn()){window.location.href=t;return}const i=a.getUser();m(i),h(i,r)}function g(e={}){document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>c(e),{once:!0}):c(e)}function f(e="settings"){try{const t=localStorage.getItem(e);return t?JSON.parse(t):{}}catch(t){return console.error("Не удалось прочитать настройки профиля",t),{}}}function d(e,t="settings"){try{return localStorage.setItem(t,JSON.stringify(e)),!0}catch(r){return console.error("Не удалось сохранить настройки профиля",r),!1}}function y({settings:e={},nameInput:t=document.getElementById("profileName"),currencySelect:r=document.getElementById("profileCurrency"),timezoneSelect:n=document.getElementById("profileTimezone"),reportCurrencySelect:o=document.getElementById("reportCurrencySelect"),balanceCurrencySelect:l=document.getElementById("balanceCurrencySelect")}={}){const i=a.getUser()||{};t&&(t.value=e.name||i.name||""),r&&(r.value=e.currency||"USD"),n&&(n.value=e.timezone||"Europe/Warsaw"),o&&(o.value=e.reportCurrency||e.currency||"USD"),l&&(l.value=e.balanceCurrency||e.currency||"USD")}export{a as A,y as a,g as i,f as l,d as s};
