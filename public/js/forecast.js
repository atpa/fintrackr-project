import{i as t}from"./chunks/navigation-BNxy9xC7.js";import{A as e}from"./chunks/api-DDAYoQqf.js";import{i as n}from"./chunks/profile-BfLkpaKJ.js";async function o(){let t;try{t=await e.utils.getForecast()}catch(D){t={predicted_income:0,predicted_expense:0}}const[n,o,c]=await Promise.all([e.transactions.getAll(),e.budgets.getAll(),e.categories.getAll()]),r="function"==typeof getReportCurrency?getReportCurrency():"USD",i=Number(t.predicted_income||0),d=Number(t.predicted_expense||0),m=i/30*7,a=d/30*7,u=i/30*90,s=d/30*90,l="function"==typeof convertAmount?convertAmount(i,"USD",r):i,f="function"==typeof convertAmount?convertAmount(d,"USD",r):d,p="function"==typeof convertAmount?convertAmount(m,"USD",r):m,g="function"==typeof convertAmount?convertAmount(a,"USD",r):a,y="function"==typeof convertAmount?convertAmount(u,"USD",r):u,x="function"==typeof convertAmount?convertAmount(s,"USD",r):s,v=document.getElementById("forecastIncome7"),A=document.getElementById("forecastExpense7"),C=document.getElementById("forecastIncome30"),E=document.getElementById("forecastExpense30"),h=document.getElementById("forecastIncome90"),I=document.getElementById("forecastExpense90");v&&(v.textContent=p.toFixed(2)),A&&(A.textContent=g.toFixed(2)),C&&(C.textContent=l.toFixed(2)),E&&(E.textContent=f.toFixed(2)),h&&(h.textContent=y.toFixed(2)),I&&(I.textContent=x.toFixed(2));const S=document.getElementById("forecastChart");S&&drawBarChart(S,["Доход 30д","Расход 30д"],[l,f]);const B=document.getElementById("riskList");if(B){B.innerHTML="";const t=new Date,e=t.getFullYear()+"-"+String(t.getMonth()+1).padStart(2,"0");if(o.forEach(t=>{if(t.month===e){const e=Number(t.spent)||0,n=Number(t.limit)||0,o=n>0?e/n:0;if(o>=.8){const e=c.find(e=>e.id===t.category_id),n=e?e.name:"Неизвестно",r=document.createElement("li");r.textContent=`${n}: потрачено ${(100*o).toFixed(0)}% из лимита`,r.style.color=o>=1?"var(--danger)":"var(--accent)",B.appendChild(r)}}}),!B.children.length){const t=document.createElement("li");t.textContent="Категории с риском превышения бюджета отсутствуют",B.appendChild(t)}}}t(),n(),"loading"!==document.readyState?o():document.addEventListener("DOMContentLoaded",o);
