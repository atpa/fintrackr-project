import{f as s}from"./api-Cdk2p__r.js";import{i as P}from"./navigation-BDLIzq93.js";import{i as k}from"./profile-BEROGLl0.js";import{b as R}from"./charts-B9MTxP37.js";P();k();async function U(){let o;try{o=await s("/api/forecast")}catch(r){console.error("Ошибка прогноза:",r),o={predicted_income:0,predicted_expense:0}}const[$,A,I]=await Promise.all([s("/api/transactions"),s("/api/budgets"),s("/api/categories")]),t=typeof getReportCurrency=="function"?getReportCurrency():"USD",c=Number(o.predicted_income||0),i=Number(o.predicted_expense||0),d=c/30*7,f=i/30*7,p=c/30*90,u=i/30*90,l=typeof convertAmount=="function"?convertAmount(c,"USD",t):c,x=typeof convertAmount=="function"?convertAmount(i,"USD",t):i,B=typeof convertAmount=="function"?convertAmount(d,"USD",t):d,F=typeof convertAmount=="function"?convertAmount(f,"USD",t):f,w=typeof convertAmount=="function"?convertAmount(p,"USD",t):p,L=typeof convertAmount=="function"?convertAmount(u,"USD",t):u,y=document.getElementById("forecastIncome7"),E=document.getElementById("forecastExpense7"),g=document.getElementById("forecastIncome30"),C=document.getElementById("forecastExpense30"),S=document.getElementById("forecastIncome90"),v=document.getElementById("forecastExpense90");y&&(y.textContent=B.toFixed(2)),E&&(E.textContent=F.toFixed(2)),g&&(g.textContent=l.toFixed(2)),C&&(C.textContent=x.toFixed(2)),S&&(S.textContent=w.toFixed(2)),v&&(v.textContent=L.toFixed(2)),document.getElementById("forecastChart")&&await R("forecastChart",["30 дней"],[{name:"Доход",data:[l]},{name:"Расход",data:[x]}],t);const n=document.getElementById("riskList");if(n){n.innerHTML="";const r=new Date,M=r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0");if(A.forEach(e=>{if(e.month===M){const N=Number(e.spent)||0,D=Number(e.limit)||0,a=D>0?N/D:0;if(a>=.8){const h=I.find(b=>b.id===e.category_id),_=h?h.name:"Неизвестно",m=document.createElement("li");m.textContent=`${_}: потрачено ${(a*100).toFixed(0)}% из лимита`,m.style.color=a>=1?"var(--danger)":"var(--accent)",n.appendChild(m)}}}),!n.children.length){const e=document.createElement("li");e.textContent="Категории с риском превышения бюджета отсутствуют",n.appendChild(e)}}}document.readyState!=="loading"?U():document.addEventListener("DOMContentLoaded",U);
