import{f as s}from"./api-Cdk2p__r.js";import{i as k}from"./navigation-BDLIzq93.js";import{i as R}from"./profile-BEROGLl0.js";k();R();async function A(){let o;try{o=await s("/api/forecast")}catch(r){console.error("Ошибка прогноза:",r),o={predicted_income:0,predicted_expense:0}}const[$,I,B]=await Promise.all([s("/api/transactions"),s("/api/budgets"),s("/api/categories")]),e=typeof getReportCurrency=="function"?getReportCurrency():"USD",c=Number(o.predicted_income||0),i=Number(o.predicted_expense||0),d=c/30*7,f=i/30*7,p=c/30*90,u=i/30*90,l=typeof convertAmount=="function"?convertAmount(c,"USD",e):c,x=typeof convertAmount=="function"?convertAmount(i,"USD",e):i,F=typeof convertAmount=="function"?convertAmount(d,"USD",e):d,w=typeof convertAmount=="function"?convertAmount(f,"USD",e):f,L=typeof convertAmount=="function"?convertAmount(p,"USD",e):p,N=typeof convertAmount=="function"?convertAmount(u,"USD",e):u,y=document.getElementById("forecastIncome7"),E=document.getElementById("forecastExpense7"),g=document.getElementById("forecastIncome30"),v=document.getElementById("forecastExpense30"),C=document.getElementById("forecastIncome90"),S=document.getElementById("forecastExpense90");y&&(y.textContent=F.toFixed(2)),E&&(E.textContent=w.toFixed(2)),g&&(g.textContent=l.toFixed(2)),v&&(v.textContent=x.toFixed(2)),C&&(C.textContent=L.toFixed(2)),S&&(S.textContent=N.toFixed(2));const D=document.getElementById("forecastChart");D&&drawBarChart(D,["Доход 30д","Расход 30д"],[l,x]);const n=document.getElementById("riskList");if(n){n.innerHTML="";const r=new Date,_=r.getFullYear()+"-"+String(r.getMonth()+1).padStart(2,"0");if(I.forEach(t=>{if(t.month===_){const M=Number(t.spent)||0,h=Number(t.limit)||0,a=h>0?M/h:0;if(a>=.8){const U=B.find(P=>P.id===t.category_id),b=U?U.name:"Неизвестно",m=document.createElement("li");m.textContent=`${b}: потрачено ${(a*100).toFixed(0)}% из лимита`,m.style.color=a>=1?"var(--danger)":"var(--accent)",n.appendChild(m)}}}),!n.children.length){const t=document.createElement("li");t.textContent="Категории с риском превышения бюджета отсутствуют",n.appendChild(t)}}}document.readyState!=="loading"?A():document.addEventListener("DOMContentLoaded",A);
