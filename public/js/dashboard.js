import{i as e}from"./chunks/navigation-BNxy9xC7.js";import{A as t}from"./chunks/api-BDCGX8nm.js";import{i as n,l as o}from"./chunks/profile-BfLkpaKJ.js";import{c,r,a}from"./chunks/charts-BffCuP_9.js";import{s as d,c as s,h as m}from"./chunks/SkeletonLoader-CzourGF4.js";import"./cardAccount.js";const i={USD:{USD:1,EUR:.94,PLN:4.5,RUB:90},EUR:{USD:1.06,EUR:1,PLN:4.8,RUB:95},PLN:{USD:.22,EUR:.21,PLN:1,RUB:20},RUB:{USD:.011,EUR:.0105,PLN:.05,RUB:1}};function l(e,t,n){if(t===n)return Number(e)||0;const o=i[t];return o&&o[n]?Number(e)*o[n]:Number(e)||0}async function u(){var e,n,i;try{if(!localStorage.getItem("user"))return void(window.location.href="login.html")}catch(R){}const u=null==(e=document.getElementById("expenseChart"))?void 0:e.parentElement,y=null==(n=document.getElementById("expensePie"))?void 0:n.parentElement,g=null==(i=document.getElementById("cashflowChart"))?void 0:i.parentElement;u&&d(u,s("bar")),y&&d(y,s("pie")),g&&d(g,s("bar"));const h=await t.transactions.getAll(),p=await t.categories.getAll();await t.budgets.getAll();const f=function(){const e=o();return e.reportCurrency||e.currency||"USD"}(),E=function(){const e=o();return e.balanceCurrency||e.reportCurrency||e.currency||"USD"}(),x=new Map;h.forEach(e=>{if("expense"===e.type){const t=p.find(t=>t.id===e.category_id),n=t?t.name:"Неизвестно",o=x.get(n)||0,c=l(Number(e.amount),e.currency||"USD",f);x.set(n,o+c)}}),Array.from(x.keys()),Array.from(x.values());const C=document.getElementById("expenseChart");if(C&&u){m(u,C);const e=c(h.filter(e=>"expense"===e.type),p,f);r(C,e)}const B=document.getElementById("expensePie");if(B&&y){m(y,B);const e=c(h.filter(e=>"expense"===e.type),p,f);r(B,e)}const U=document.getElementById("cashflowChart");if(U&&g){m(g,U);const e=a(h,E,6);r(U,e)}const I=document.getElementById("topCategories");if(I){const e=Array.from(x.entries()).sort((e,t)=>t[1]-e[1]);I.innerHTML="";const t=5;if(e.slice(0,t).forEach(([e,t])=>{const n=document.createElement("li");n.textContent=`${e}: ${t.toFixed(2)} ${f}`,I.appendChild(n)}),!e.length){const e=document.createElement("li");e.textContent="Нет данных",I.appendChild(e)}}let L=0,S=0;h.forEach(e=>{const t=l(Number(e.amount),e.currency||"USD",E);"income"===e.type?L+=t:"expense"===e.type&&(S+=t)});const k=document.getElementById("totalBalance"),b=document.getElementById("totalIncome"),D=document.getElementById("totalExpense");k&&(k.textContent=(L-S).toFixed(2)),b&&(b.textContent=L.toFixed(2)),D&&(D.textContent=S.toFixed(2));try{document.querySelectorAll(".currency-code").forEach(e=>{e.textContent=E})}catch(A){}const N=L>0?Math.max((L-S)/L,0):0,v=document.getElementById("financialHealth"),w=document.getElementById("healthProgress");v&&(v.textContent=(100*N).toFixed(0)+"%"),w&&(w.style.width=(100*N).toFixed(0)+"%");try{const e=await t.utils.getForecast(),n=document.getElementById("aiIncome"),o=document.getElementById("aiExpense");if(e&&n&&o){const t=l(Number(e.predicted_income||0),"USD",E),c=l(Number(e.predicted_expense||0),"USD",E);n.textContent=t.toFixed(2),o.textContent=c.toFixed(2)}}catch(A){}}e(),n();const y=()=>{document.getElementById("expenseChart")&&u()};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",y):y(),function(){if(document.querySelector(".theme-toggle"))return;try{"dark"===localStorage.getItem("ft_theme")&&(document.documentElement.classList.add("dark"),document.body.classList.add("dark"))}catch(t){}const e=document.createElement("button");e.className="theme-toggle",e.textContent=document.documentElement.classList.contains("dark")?"Light":"Dark",e.addEventListener("click",function(){const n=document.documentElement.classList.toggle("dark");document.body.classList.toggle("dark",n);try{localStorage.setItem("ft_theme",n?"dark":"light")}catch(t){}e.textContent=n?"Light":"Dark"}),document.addEventListener("DOMContentLoaded",()=>document.body.appendChild(e))}();
